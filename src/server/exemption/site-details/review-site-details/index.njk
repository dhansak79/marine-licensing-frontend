{% extends 'layouts/page.njk' %}

{% from "govuk/components/back-link/macro.njk" import govukBackLink %}
{% from "govuk/components/summary-list/macro.njk" import govukSummaryList %}
{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "cancel-button/macro.njk" import appCancelButton %}

{% block pageTitle %}
  Review site details | {{ serviceName }}
{% endblock %}

{% block head %}
  {{ super() }}
  <link href="/public/stylesheets/ol.css" rel="stylesheet">
{% endblock %}

{% block beforeContent %}
    {{ govukBackLink({
        text: "Back",
        href: backLink
    }) }}
{% endblock %}

{% block content %}
    <div class="govuk-grid-row">
        <div class="govuk-grid-column-full">
            
            <span class="govuk-caption-l">{{ projectName }}</span>
            <h1 class="govuk-heading-l">{{ heading }}</h1>

            {% set summaryRows = [
                {
                    key: {
                        text: "Method of providing site location"
                    },
                    value: {
                        text: summaryData.method
                    }
                },
                {
                    key: {
                        text: "Coordinate system"
                    },
                    value: {
                        html: summaryData.coordinateSystem | replace('\n', '<br>')
                    }
                }
            ] %}

            {% if summaryData.polygonCoordinates %}
                {# Polygon site - multiple coordinates #}
                {% for coordinate in summaryData.polygonCoordinates %}
                    {% set summaryRows = (summaryRows.push({
                        key: {
                            text: coordinate.label
                        },
                        value: {
                            text: coordinate.value
                        }
                    }), summaryRows) %}
                {% endfor %}
            {% else %}
                {# Circular site - single coordinate and width #}
                {% set summaryRows = (summaryRows.push({
                    key: {
                        text: "Coordinates at centre of site"
                    },
                    value: {
                        text: summaryData.coordinates
                    }
                }), summaryRows) %}
                {% set summaryRows = (summaryRows.push({
                    key: {
                        text: "Width of circular site"
                    },
                    value: {
                        text: summaryData.width
                    }
                }), summaryRows) %}
            {% endif %}

            {# Add map view row for all coordinate types #}
            {% set summaryRows = (summaryRows.push({
                key: {
                    text: "Map view",
                    classes: "govuk-summary-list__key--top-aligned"
                },
                value: {
                    html: '<div class="app-site-details-map" data-module="site-details-map"></div>'
                }
            }), summaryRows) %}

            {{ govukSummaryList({
                card: {
                    title: {
                        text: "Site details"
                    }
                },
                rows: summaryRows
            }) }}

            <!-- Site Details Data for JavaScript -->
            <script type="application/json" id="site-details-data">
                {{ siteDetailsData | safe }}
            </script>
            
            <form method="POST">
                <input type="hidden" name="csrfToken" value="{{csrfToken}}">
                                
                <div class="govuk-button-group">
                    {{ govukButton({
                        text: "Save and continue",
                        attributes: {
                            id: "continue"
                        }
                    }) }}

                    {{ appCancelButton({
                        cancelLink: "/exemption/task-list?cancel=site-details"
                    }) }}
                </div>
            </form>
            
        </div>
    </div>
{% endblock %} 